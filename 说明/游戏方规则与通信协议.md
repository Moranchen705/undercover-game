# 谁是卧底 · 游戏方规则与通信协议

## 1. 文档目的
- 由主持人统一发送给全部参赛组，确保对游戏流程、交流约定和行为规范有一致理解。
- 涵盖基础规则、术语定义、通信协议以及异常处理办法。

## 2. 基础流程概览
1. 通过注册接口提交唯一的 `group_name`（推荐使用队名或谐音）。
2. 等待主持人宣布开局并接收身份及词语。
3. 主持人开启描述阶段后，按提示完成描述。
4. 主持人开启投票阶段后，提交本轮投票。
5. 主持人处理投票并公布淘汰结果、得分及下一轮安排。
6. 重复“描述-投票”直到判定胜负。

## 3. 角色与术语
- **游戏方**：参赛小组，使用本协议与主持端交互。
- **主持端**：Undercover 主持平台，负责身份分配、回合控制、积分统计。
- **平民词 / 卧底词**：主持人分配给不同身份的词语，两个词语语义相近。
- **描述阶段**：主持人开放时间段，允许每组提交一次描述。
- **投票阶段**：主持人开放时间段，允许每组提交一次投票对象。

## 4. 行为规范
- 描述为一句话，建议 5~30 个汉字。
- 禁止在描述中直接说出词语本体或透露身份。
- 描述、投票均仅能提交一次，提交后不可撤销。
- 如遇故障，立即按第 8 节流程上报。

## 5. 通信约定

### 5.1 基础设置
- 协议：HTTP/HTTPS JSON API，字符集 UTF-8。
- 身份：`group_name` 在注册后即为唯一凭据；请勿与他人共享。
- 主持方控制接口（`/api/game/*`）受 `X-Admin-Token` 保护，仅主持端使用。
- 游戏方只需调用本节列出的开放接口。

### 5.2 开放 API 一览

| 场景 | 方法 | 路径 | 请求示例 | 响应示例 | 说明 |
|------|------|------|----------|----------|------|
| 注册组名 | `POST` | `/api/register` | `{ "group_name": "望月队" }` | `{ "code": 200, "message": "注册成功", "data": { "group_name": "望月队", "total_groups": 3 } }` | 每组仅注册一次 |
| 获取词语 | `GET` | `/api/word?group_name=望月队` | — | `{ "code": 200, "message": "ok", "data": { "word": "向日葵" } }` | 仅返回自己的词语 |
| 获取阶段状态 | `GET` | `/api/status` | — | `{ "code": 200, "message": "ok", "data": { "status": "describing", "round": 2, "describe_order": ["望月队","青木队"], "eliminated_groups": [] } }` | 轮询频率≤1次/3秒 |
| 提交描述 | `POST` | `/api/describe` | `{ "group_name": "望月队", "description": "偏爱夜景的城市" }` | `{ "code": 200, "message": "描述提交成功", "data": { "round": 2, "total_descriptions": 3 } }` | 仅限描述阶段 |
| 提交投票 | `POST` | `/api/vote` | `{ "voter_group": "望月队", "target_group": "青木队" }` | `{ "code": 200, "message": "投票提交成功", "data": {} }` | 仅限投票阶段，禁止投自己 |
| 获取最新结果 | `GET` | `/api/result` | — | `{ "code": 200, "message": "ok", "data": { "round": 2, "eliminated": ["青木队"], "game_ended": false } }` | 投票处理完成后可查 |
| 反馈异常 | `POST` | `/api/report` | `{ "group_name": "望月队", "type": "network", "detail": "描述时断线" }` | `{ "code": 200, "message": "异常已记录", "data": { "ticket": "RPT-2025-001" } }` | 生成唯一工单编号 |

> **提示**：所有响应体均采用 `{ "code": <状态码>, "message": "<文字信息>", "data": { ... } }` 结构；当 `code != 200` 时，需根据 `message` 判断失败原因。

## 6. 时间与频率限制
- 注册需在主持人公布的截止时间前完成，逾期无法参与当局。
- 状态轮询：建议 2~3 秒一次；请勿并发刷接口。
- 描述提交：主持人宣布“开始描述”后 45 秒内完成，超时视为弃权。
- 投票提交：主持人宣布“开始投票”后 30 秒内完成，超时视为自投。

