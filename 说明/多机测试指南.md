# 多机测试指南

## 概述

项目已经支持多台电脑联网运行。主持方和游戏方可以在不同的电脑上运行，通过局域网连接。

## 准备工作

### 1. 确保所有电脑在同一局域网

- 所有电脑连接到同一个WiFi或路由器
- 确保局域网可以互相访问（关闭防火墙或添加例外规则）

### 2. 检查防火墙设置

**Windows系统：**
1. 打开"Windows Defender 防火墙"
2. 点击"允许应用通过防火墙"
3. 确保Python和Pythonw在"专用"和"公用"网络中都允许
4. 或者临时关闭防火墙进行测试（测试完记得开启）

**快速检查方法：**
- 在主持方电脑上，打开命令提示符（cmd）
- 输入 `ipconfig`，查看IPv4地址（例如：192.168.1.100）
- 在游戏方电脑上，打开浏览器访问 `http://主持方IP:5000/api/status`
- 如果能看到JSON响应，说明网络连通

## 测试步骤

### 第一步：主持方电脑操作

1. **启动后端服务器**
   ```bash
   cd 平台方
   python backend.py
   ```

2. **记录服务器IP地址**
   - 启动后会显示类似以下信息：
     ```
     ==================================================
     谁是卧底 - 主持方平台
     ==================================================
     服务器启动中...
     本地访问: http://127.0.0.1:5000
     局域网访问: http://192.168.1.100:5000  ← 这个就是游戏方要用的地址
     ==================================================
     ```
   - **重要**：将"局域网访问"的IP地址（例如：`192.168.1.100`）告诉所有游戏方组员

3. **（可选）启动前端界面**
   ```bash
   cd 平台方
   python frontend.py
   ```
   - 主持方可以在浏览器访问：`http://127.0.0.1:5001` 或 `http://192.168.1.100:5001`
   - 游戏方也可以访问：`http://192.168.1.100:5001`（但只能查看，不能操作）

### 第二步：游戏方电脑操作（每个组员）

1. **确保项目代码已同步**
   - 所有组员应该有相同的项目代码
   - 确保依赖已安装（`pip install -r Requirements.txt`）

2. **启动游戏客户端**
   ```bash
   cd 玩家方
   python client.py
   ```

3. **配置服务器地址**
   - 在客户端界面的"服务器地址"输入框中
   - 将默认的 `http://127.0.0.1:5000` 改为主持方的IP地址
   - 例如：`http://192.168.1.100:5000`
   - **注意**：不要忘记 `http://` 前缀

4. **注册组名**
   - 输入组名（例如：`组1`、`组2`等）
   - 点击"注册"按钮
   - 如果看到"注册成功"的日志，说明连接正常

### 第三步：开始游戏

1. **主持方操作**（在前端界面或通过API）：
   - 输入卧底词和平民词
   - 点击"开始游戏"
   - 点击"开始新回合"

2. **游戏方操作**：
   - 客户端会自动获取词语
   - 在描述阶段输入描述并提交
   - 在投票阶段选择投票目标并提交

3. **观察结果**：
   - 主持方可以在前端界面看到实时投票进度
   - 所有组投票完成后，主持方点击"处理投票结果"

## 常见问题排查

### Q1: 游戏方无法连接到服务器

**错误信息**：`连接失败：无法连接到服务器 http://192.168.1.100:5000`

**排查步骤**：
1. ✅ 确认主持方后端服务器已启动
2. ✅ 确认服务器地址正确（包含 `http://` 前缀）
3. ✅ 确认IP地址正确（使用主持方显示的"局域网访问"地址）
4. ✅ 确认两台电脑在同一局域网
5. ✅ 检查防火墙设置
6. ✅ 在游戏方电脑上，用浏览器访问 `http://主持方IP:5000/api/status` 测试连通性

### Q2: 如何确认IP地址？

**方法1：查看后端启动日志**
- 后端启动时会自动显示局域网IP

**方法2：手动查询（Windows）**
```bash
# 在命令提示符（cmd）中输入
ipconfig
# 查找"IPv4 地址"，通常是 192.168.x.x 或 10.x.x.x
```

**方法3：手动查询（Mac/Linux）**
```bash
ifconfig
# 或
ip addr
```

### Q3: 可以混合使用本地和远程连接吗？

**可以！** 例如：
- 主持方：1台电脑运行后端
- 游戏方：2台电脑运行客户端（远程连接）
- 游戏方：另外2个组在同一台电脑上运行多个客户端（本地连接）

只要所有客户端都指向正确的服务器地址即可。

### Q4: 如何测试网络连通性？

**在游戏方电脑上测试：**

1. **使用浏览器**：
   - 访问 `http://主持方IP:5000/api/status`
   - 如果看到JSON数据，说明网络正常

2. **使用命令行**（Windows）：
   ```bash
   ping 192.168.1.100
   ```

3. **使用Python测试**：
   ```python
   import requests
   response = requests.get("http://192.168.1.100:5000/api/status")
   print(response.json())
   ```

### Q5: 端口被占用怎么办？

如果5000或5001端口被占用：

1. **修改后端端口**（`平台方/backend.py`）：
   ```python
   app.run(host='0.0.0.0', port=5000, debug=True)  # 改为其他端口，如5002
   ```

2. **修改前端端口**（`平台方/frontend.py`）：
   ```python
   frontend_app.run(host='0.0.0.0', port=5001, debug=True)  # 改为其他端口，如5003
   ```

3. **游戏方客户端也要相应修改服务器地址**：
   - 例如：`http://192.168.1.100:5002`

## 推荐测试流程

### 第一次多机测试

1. **准备阶段**：
   - 所有组员确保代码同步
   - 确认网络连接正常
   - 主持方启动服务器，记录IP地址

2. **连接测试**：
   - 每个游戏方先单独测试连接
   - 确认都能成功注册

3. **小规模测试**：
   - 先2-3个组测试一轮完整游戏
   - 确认所有功能正常

4. **完整测试**：
   - 所有5个组一起测试
   - 测试多轮游戏

### 日常开发建议

- **开发阶段**：可以在自己电脑上同时运行多个客户端进行测试
- **联调阶段**：使用多机测试，模拟真实环境
- **演示前**：务必进行完整的多机测试，确保网络配置正确

## 注意事项

1. ⚠️ **IP地址可能会变化**：如果电脑重新连接WiFi，IP地址可能会改变，需要重新告知组员
2. ⚠️ **防火墙设置**：确保防火墙允许Python程序访问网络
3. ⚠️ **网络稳定性**：确保网络连接稳定，避免中途断线
4. ⚠️ **代码同步**：所有组员应该使用相同版本的代码

## 快速检查清单

在开始多机测试前，确认：

- [ ] 所有电脑在同一局域网
- [ ] 主持方后端服务器已启动
- [ ] 主持方已记录并告知IP地址
- [ ] 游戏方已修改客户端服务器地址
- [ ] 防火墙已配置允许Python访问
- [ ] 网络连通性测试通过
- [ ] 所有组员代码已同步

