# 规则更新说明（2025版）

## 📋 更新日期
根据老师最新发布的选题说明，本文档记录了所有规则变化。

---

## 🔴 主要变化总结

### 1. 游戏方数量变化
- **旧规则**：游戏方 4 个组
- **新规则**：游戏方 **5 个组** ⭐

### 2. 游戏次数要求（新增）
- **新规则**：游戏的次数应为 **5 的倍数**，保证每个游戏组都有相同的次数能够成为卧底
- **说明**：这意味着如果进行多局游戏，需要确保每个组都有相同的机会成为卧底

### 3. 投票规则变化 ⚠️ **重要**

#### 旧规则：
- **情况a**：得票最多的组仅 1 个 → 该组被淘汰
- **情况b**：得票最多的组有 2 个 → 
  - 若均为平民组：两组均淘汰，游戏结束，卧底阵营胜利
  - 若含卧底组：无事发生，进入下一轮
- **情况c**：得票最多的组超过 2 个 → 无事发生，进入下一轮

#### 新规则：
- **情况a**：得票最多的组仅 1 个 → 该组被淘汰
  - 若淘汰组是卧底：游戏结束，平民阵营胜利
  - 若淘汰组是平民：返回步骤 3（游戏继续）
- **情况b**：得票最多的组有 **3 个** → 
  - 若均为平民组：**3 组均淘汰**，游戏结束，卧底阵营胜利
- **情况c**：得票最多的组有 **2 个** → 进入下一轮（返回步骤 3）

**关键变化**：
- 情况b从"2组"变为"3组"
- 情况c从"超过2组"变为"2组"

### 4. 得分规则变化 ⚠️ **重要**

#### 旧规则：
- **卧底得分**：
  - 胜利分：平民仅剩1组时得3分
  - 生存分：每生存一轮得1分
  - **最终得分 = max(胜利分, 生存分)**（取较大值）
- **平民得分**：未明确说明

#### 新规则：
- **卧底得分**：
  - 胜利分：平民仅剩1组时得3分
  - 生存分：每生存一轮得1分
  - **最终得分 = 胜利分 + 生存分**（求和）⭐
- **平民得分**（新增）：
  - 生存分：每生存一轮得1分
  - **最终得分 = 该次游戏中的生存分之和**⭐

**关键变化**：
- 卧底得分从"取较大值"改为"求和"
- 新增了平民得分计算规则

---

## 📝 已更新的文档

1. ✅ `期末作业选题.md` - 已更新所有规则变化
2. ✅ `项目理解总结.md` - 已更新游戏方数量、投票规则、得分规则
3. ⚠️ `游戏方规则与通信协议.md` - 无需更新（不涉及具体规则细节）

---

## ⚠️ 需要更新的代码

### 平台方代码需要更新：

1. **`platform方/game_logic.py`**：
   - `register_group()` 方法：最大组数限制从4改为5
   - `process_voting_result()` 方法：投票判定逻辑需要更新
     - 情况b：判断"得票最多3组"（而不是2组）
     - 情况c：判断"得票最多2组"（而不是超过2组）
   - `_calculate_scores()` 方法：得分计算需要更新
     - 卧底得分：改为 `胜利分 + 生存分`（求和）
     - 平民得分：新增计算逻辑 `生存分之和`

2. **`platform方/backend.py`**：
   - 注册接口的错误提示：从"最大组数(4组)"改为"最大组数(5组)"

### 游戏方代码：
- 无需更新（游戏方代码不涉及规则判定，只需按照新规则参与游戏）

---

## 🎯 对游戏方的影响

### 对游戏方客户端开发的影响：
1. **组数变化**：现在最多5组参与，界面和逻辑需要考虑5组的情况
2. **投票策略**：由于投票规则变化，投票策略可能需要调整
3. **得分理解**：需要理解新的得分规则（卧底和平民都有得分）

### 对游戏策略的影响：
- 投票规则变化可能影响投票决策
- 得分规则变化可能影响游戏目标（平民也有得分了）

---

## 📌 注意事项

1. **描述时间限制**：
   - 题目要求：描述间隔不超过3秒
   - 协议文档：描述提交45秒内完成
   - **建议**：以题目要求为准（间隔≤3秒），但实际实现时需要考虑可操作性

2. **游戏次数要求**：
   - 新规则要求游戏次数为5的倍数
   - 这可能需要平台方实现多局游戏的轮换机制
   - 需要确认平台方是否需要实现此功能

3. **代码更新优先级**：
   - **P0**：投票判定逻辑更新（影响游戏流程）
   - **P0**：得分计算更新（影响最终成绩）
   - **P1**：组数限制更新（影响注册）

---

## ✅ 检查清单

- [x] 更新 `期末作业选题.md`
- [x] 更新 `项目理解总结.md`
- [ ] 更新平台方代码 `game_logic.py`（投票判定逻辑）
- [ ] 更新平台方代码 `game_logic.py`（得分计算逻辑）
- [ ] 更新平台方代码 `backend.py`（组数限制提示）
- [ ] 测试新规则下的游戏流程
- [ ] 确认游戏次数轮换机制是否需要实现

---

## 📞 待确认问题

1. **游戏次数轮换机制**：
   - 新规则要求"游戏次数应为5的倍数，保证每个游戏组都有相同的次数能够成为卧底"
   - 这是否意味着需要实现多局游戏的自动轮换？
   - 还是只需要在测试时手动进行5局游戏？

2. **描述时间限制**：
   - 题目说"间隔不超过3秒"，这是指每个组描述之间的间隔？
   - 还是指每个组必须在3秒内完成描述？

3. **平台方代码更新**：
   - 是否需要立即更新平台方代码？
   - 还是先更新文档，等测试时再更新代码？

---

**最后更新**：根据2025版选题说明整理

